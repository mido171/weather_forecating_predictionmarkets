# Sigma Chooser Backtest Summary

## Run
run_id: sigma_chooser_run
config_source: experiments\configs\sigma_chooser_backtest.json
dataset_path: C:\Users\ahmad\Desktop\generalFiles\git\weather-forecasting-predictionmarkets\weather_forecating_predictionmarkets\ingestion-service\src\main\resources\trainingdata_output\gribstream_training_data.csv
dataset_hash: ec850d6715df5451e93b6e147f0cf97ee2eed8ad5bb3f42314f49d4b2b853922
dataset_id: 032a85d788cb83fa9d2170560d23152c5aa7e28f8a79deb3b8455e97dd103a0e
feature_set_name: E24
r_feature: gefsatmos_tmp_spread_f
train_start: 2021-01-01
train_end: 2024-12-31
test_start: 2025-01-01
test_end: 2025-12-31
truth_lag: 2
sigma_floor: 0.25

## Data Snapshot
rows: 1771
stations: ['KNYC']
min_date: 2021-02-23 00:00:00
max_date: 2025-12-31 00:00:00
rows_by_year:
{
  "2021": 312,
  "2022": 365,
  "2023": 365,
  "2024": 366,
  "2025": 363
}
missingness:
{
  "actual_tmax_f": 0,
  "asof_utc": 0,
  "cos_doy": 0,
  "day_of_year": 0,
  "ens_iqr": 0,
  "ens_mad": 0,
  "ens_max": 0,
  "ens_mean": 0,
  "ens_median": 0,
  "ens_min": 0,
  "ens_outlier_gap": 0,
  "ens_range": 0,
  "ens_std": 0,
  "gefs_spread": 0,
  "gefsatmos_tmp_spread_f": 0,
  "gefsatmosmean_tmax_f": 0,
  "gfs_tmax_f": 0,
  "hrrr_tmax_f": 0,
  "is_weekend": 0,
  "month": 0,
  "nam_tmax_f": 0,
  "nbm_tmax_f": 0,
  "rap_tmax_f": 0,
  "resid_ens_mean": 0,
  "resid_ens_median": 0,
  "sin_doy": 0,
  "station_id": 0,
  "target_date_local": 0
}

## Mean Model
{
  "name": "lgbm",
  "params": {
    "bagging_fraction": 0.8,
    "feature_fraction": 0.8,
    "lambda_l1": 0.0,
    "lambda_l2": 0.0,
    "learning_rate": 0.05,
    "min_data_in_leaf": 20,
    "n_estimators": 300,
    "num_leaves": 63
  }
}
train_metrics:
{
  "bias": -1.8769859404117866e-12,
  "mae": 0.29539527328384807,
  "n": 1408,
  "rmse": 0.4561294619718302
}

## Calibration - Global
{
  "bias_mean_error_f": 0.002109650172455826,
  "calibration_window": {
    "end": "2024-12-31",
    "start": "2021-01-01"
  },
  "created_utc": "2026-01-15T06:58:09Z",
  "dataset_ref": {
    "dataset_hash": "ec850d6715df5451e93b6e147f0cf97ee2eed8ad5bb3f42314f49d4b2b853922",
    "dataset_id": "032a85d788cb83fa9d2170560d23152c5aa7e28f8a79deb3b8455e97dd103a0e",
    "rows_used": 1096
  },
  "ddof": 1,
  "error_definition": "e = actual_tmax_f - mu_hat_oof",
  "mae_f": 2.1964792613276405,
  "method": "global_normal_residual",
  "model_ref": {
    "model_hash": "faa6d83ddf74f7b0726840be429171de8bc1bf93238f8d372e2e54920395cbe9",
    "model_name": "lgbm",
    "model_params": {
      "bagging_fraction": 0.8,
      "feature_fraction": 0.8,
      "lambda_l1": 0.0,
      "lambda_l2": 0.0,
      "learning_rate": 0.05,
      "min_data_in_leaf": 20,
      "n_estimators": 300,
      "num_leaves": 63
    },
    "model_path": "C:\\Users\\ahmad\\Desktop\\generalFiles\\git\\weather-forecasting-predictionmarkets\\weather_forecating_predictionmarkets\\experiments\\results\\sigma_chooser_backtest\\sigma_chooser_run\\mean_model_artifacts\\mean_model.joblib"
  },
  "n": 1096,
  "residual_quantiles_f": {
    "p01": -10.64346944967255,
    "p05": -4.620445302626191,
    "p10": -3.2727338473354095,
    "p50": 0.17639829827096065,
    "p90": 3.4454228375616225,
    "p95": 4.54754524221479,
    "p99": 6.882379759244026
  },
  "rmse_f": 3.130105204180444,
  "sigma_std_error_f": 3.1315334385313176,
  "station_scope": {
    "mode": "LIST",
    "stations": [
      "KNYC"
    ]
  }
}

## Calibration - Sigma Chooser
{
  "bins": {
    "HIGH": {
      "bias_mean_error_f": 0.08488499679323773,
      "n": 366,
      "shrunk": false,
      "sigma_std_error_f": 3.2684304856729685
    },
    "LOW": {
      "bias_mean_error_f": 0.07894558272662042,
      "n": 365,
      "shrunk": false,
      "sigma_std_error_f": 3.0921465382386453
    },
    "MID": {
      "bias_mean_error_f": -0.15772841077405425,
      "n": 365,
      "shrunk": false,
      "sigma_std_error_f": 3.031261141567225
    }
  },
  "calibration_window": {
    "end": "2024-12-31",
    "start": "2021-01-01"
  },
  "created_utc": "2026-01-15T06:58:09Z",
  "global_fallback": {
    "bias_mean_error_f": 0.002109650172455826,
    "sigma_std_error_f": 3.1315334385313176
  },
  "method": "sigma_chooser",
  "min_samples_per_bin": 60,
  "r_feature": "gefsatmos_tmp_spread_f",
  "r_thresholds": {
    "p_high": 0.666666,
    "p_low": 0.333333,
    "t_high": 2.3811972916177355,
    "t_low": 1.6603526089234553
  },
  "shrinkage": true
}

## Scores Summary (2025)
{
  "chooser": {
    "brier_by_threshold": {
      "100": 1.4185388846980125e-05,
      "101": 2.9433575403240517e-06,
      "102": 5.102881794871816e-07,
      "103": 7.37840297538928e-08,
      "104": 8.891656740816811e-09,
      "14": 9.844879206631102e-10,
      "15": 9.959483332436209e-09,
      "16": 8.302057071666793e-08,
      "17": 5.71508941986968e-07,
      "18": 3.258416116638253e-06,
      "19": 1.5443502293829662e-05,
      "20": 0.0024936968423509855,
      "21": 0.004393816046761757,
      "22": 0.003915063685841273,
      "23": 0.0036039450757850214,
      "24": 0.0037605442710308638,
      "25": 0.004669349965920358,
      "26": 0.006464962103145813,
      "27": 0.007392614466009246,
      "28": 0.008872705336934971,
      "29": 0.010696521853553506,
      "30": 0.008046403483676343,
      "31": 0.008454812022781198,
      "32": 0.01591453998826121,
      "33": 0.017683688541556355,
      "34": 0.017569112984224883,
      "35": 0.017753508373562113,
      "36": 0.016512014244406133,
      "37": 0.012024708487297548,
      "38": 0.011525619349749654,
      "39": 0.013747722855299451,
      "40": 0.014469795075537015,
      "41": 0.019415778619760148,
      "42": 0.018448425102790923,
      "43": 0.01643923983783458,
      "44": 0.010234678090375248,
      "45": 0.011683067187096191,
      "46": 0.0151408007307596,
      "47": 0.017730706605662262,
      "48": 0.020644514060217573,
      "49": 0.024411295243472044,
      "50": 0.022799371569360138,
      "51": 0.024189174599400315,
      "52": 0.02710222775638588,
      "53": 0.025225638453853585,
      "54": 0.017520171308314868,
      "55": 0.020684537208217134,
      "56": 0.02139239005594917,
      "57": 0.02236476330117419,
      "58": 0.022402229508038055,
      "59": 0.023442609576697353,
      "60": 0.019930958987086498,
      "61": 0.020719269379417433,
      "62": 0.022810182051867908,
      "63": 0.026396856999409978,
      "64": 0.02028826056594896,
      "65": 0.020164728987477044,
      "66": 0.01963640255736501,
      "67": 0.01641281061541616,
      "68": 0.021513792005182136,
      "69": 0.019777741921096076,
      "70": 0.019359644621415335,
      "71": 0.021332215546774436,
      "72": 0.02130678286151784,
      "73": 0.021932929877342425,
      "74": 0.017495996841488358,
      "75": 0.01631897010375571,
      "76": 0.01889969124894019,
      "77": 0.01734194886754318,
      "78": 0.018983537299972892,
      "79": 0.020452196557416338,
      "80": 0.024209068799869466,
      "81": 0.026441067757697344,
      "82": 0.030011824830359374,
      "83": 0.031786506819094756,
      "84": 0.0320427387095779,
      "85": 0.025364424887313206,
      "86": 0.015727009455552138,
      "87": 0.014285420536275507,
      "88": 0.016801368836055493,
      "89": 0.022300382326709608,
      "90": 0.015795475267048296,
      "91": 0.010293459713494612,
      "92": 0.0058021793953124835,
      "93": 0.005733574852265276,
      "94": 0.005843438804709486,
      "95": 0.007453944302664455,
      "96": 0.006810896055092896,
      "97": 0.004079034857478338,
      "98": 0.002402522564223096,
      "99": 0.00251943280984197
    },
    "brier_mean": 0.014264313653277608,
    "crps_mean": 1.2837956162207214,
    "crps_median": 0.9990139964335271,
    "intervals": {
      "0.5": {
        "avg_width": 4.216581326696048,
        "coverage": 0.6804407713498623
      },
      "0.8": {
        "avg_width": 8.011636053627958,
        "coverage": 0.9421487603305785
      },
      "0.9": {
        "avg_width": 10.282823551485496,
        "coverage": 0.9752066115702479
      },
      "0.95": {
        "avg_width": 12.25273999464903,
        "coverage": 0.9889807162534435
      }
    },
    "nll_mean": 2.3070198078014683
  },
  "crps_delta_bootstrap": {
    "mean": -0.0028003146447468153,
    "p025": -0.008230012075426207,
    "p975": 0.002111368706894592,
    "samples": 1000
  },
  "delta": {
    "brier_mean": -3.742100329498163e-05,
    "crps_mean": -0.0028167464866128977,
    "nll_mean": 0.00190449309226004
  },
  "global": {
    "brier_by_threshold": {
      "100": 1.543003307786442e-05,
      "101": 3.2747099059502596e-06,
      "102": 5.809514428346789e-07,
      "103": 8.584480422757224e-08,
      "104": 1.053494204588382e-08,
      "14": 1.5108928125590636e-09,
      "15": 1.4112515874064566e-08,
      "16": 1.0943713157309727e-07,
      "17": 7.064367554284122e-07,
      "18": 3.808275971858836e-06,
      "19": 1.721167951553352e-05,
      "20": 0.00246861970414752,
      "21": 0.004313550870745556,
      "22": 0.003815417339793379,
      "23": 0.00348576617561688,
      "24": 0.003623143358977066,
      "25": 0.004515975445668923,
      "26": 0.006311202394634924,
      "27": 0.007389506359209073,
      "28": 0.008805123086819295,
      "29": 0.010629377576249604,
      "30": 0.008065408397088527,
      "31": 0.008299684789231624,
      "32": 0.01570669252904552,
      "33": 0.01751082979247583,
      "34": 0.017782173286503448,
      "35": 0.017885890058611506,
      "36": 0.016547119964044732,
      "37": 0.012334248056816025,
      "38": 0.011876172677648102,
      "39": 0.01402257452563463,
      "40": 0.014681550543250876,
      "41": 0.019674080357859686,
      "42": 0.01858330427711425,
      "43": 0.016372896423819224,
      "44": 0.01013445437397337,
      "45": 0.011554706878345077,
      "46": 0.014758349656087591,
      "47": 0.01721281349737936,
      "48": 0.02012418393770169,
      "49": 0.02373377015987757,
      "50": 0.02239404434636666,
      "51": 0.02415720450917387,
      "52": 0.026929699866021662,
      "53": 0.02499502476077222,
      "54": 0.017377474181930214,
      "55": 0.020370790661043747,
      "56": 0.021158245200944285,
      "57": 0.02219720069935099,
      "58": 0.022282888128094293,
      "59": 0.02334649424515669,
      "60": 0.019851269803286952,
      "61": 0.020621496238610863,
      "62": 0.022551132444486338,
      "63": 0.025982646538915913,
      "64": 0.01989244215284674,
      "65": 0.02005434047781253,
      "66": 0.0196753550402413,
      "67": 0.01675511991685534,
      "68": 0.021773965445771672,
      "69": 0.019945902383791576,
      "70": 0.019305200689848683,
      "71": 0.021299436092960547,
      "72": 0.021284382479636356,
      "73": 0.02177422475136661,
      "74": 0.017367288093644778,
      "75": 0.016284397314430397,
      "76": 0.01880172355885548,
      "77": 0.01731982925483981,
      "78": 0.018886706871332263,
      "79": 0.020688079585101164,
      "80": 0.024403589511740466,
      "81": 0.026867282386790124,
      "82": 0.030427273395143863,
      "83": 0.032039090772199276,
      "84": 0.03260739562800974,
      "85": 0.025579175214462655,
      "86": 0.015710388638495432,
      "87": 0.014220624797412313,
      "88": 0.016885450453131813,
      "89": 0.022236734127082734,
      "90": 0.015595250870595479,
      "91": 0.01012850092796556,
      "92": 0.0057501796444395705,
      "93": 0.005698916783257443,
      "94": 0.005947111637898816,
      "95": 0.00749221716680256,
      "96": 0.006701801313824846,
      "97": 0.003998326338422691,
      "98": 0.002317454980282428,
      "99": 0.0024566408056445788
    },
    "brier_mean": 0.014226892649982626,
    "crps_mean": 1.2809788697341085,
    "crps_median": 0.9808718095624451,
    "intervals": {
      "0.5": {
        "avg_width": 4.224374413371329,
        "coverage": 0.6859504132231405
      },
      "0.8": {
        "avg_width": 8.026443161410157,
        "coverage": 0.9366391184573003
      },
      "0.9": {
        "avg_width": 10.30182826857611,
        "coverage": 0.9724517906336089
      },
      "0.95": {
        "avg_width": 12.27538551180851,
        "coverage": 0.9889807162534435
      }
    },
    "nll_mean": 2.3089243008937284
  },
  "point": {
    "bias": 0.04794353127735498,
    "mae": 1.7225120853429972,
    "rmse": 2.207464214694548
  }
}

## Breakdown by Bin (2025)
bin_assigned   n  crps_global  crps_chooser  nll_global  nll_chooser  brier_global  brier_chooser  coverage_global_0.5  coverage_chooser_0.5  coverage_global_0.8  coverage_chooser_0.8  coverage_global_0.9  coverage_chooser_0.9  coverage_global_0.95  coverage_chooser_0.95
        HIGH 111     1.463803      1.474940    2.404383     2.420112      0.016144       0.016178             0.612613              0.621622             0.900901              0.918919             0.954955              0.963964              0.972973               0.972973
         LOW 131     1.177231      1.176333    2.256838     2.251048      0.012927       0.012825             0.717557              0.717557             0.954198              0.954198             0.977099              0.977099              0.992366               0.992366
         MID 121     1.225587      1.224792    2.277746     2.263872      0.013875       0.014068             0.719008              0.694215             0.950413              0.950413             0.983471              0.983471              1.000000               1.000000

## Breakdown by Month (2025)
 month  n  crps_global  crps_chooser  nll_global  nll_chooser  brier_global  brier_chooser  coverage_global_0.5  coverage_chooser_0.5  coverage_global_0.8  coverage_chooser_0.8  coverage_global_0.9  coverage_chooser_0.9  coverage_global_0.95  coverage_chooser_0.95
     1 31     1.384576      1.397575    2.360629     2.363272      0.015375       0.015473             0.709677              0.709677             0.870968              0.870968             0.903226              0.903226              1.000000               1.000000
     2 28     1.411143      1.427626    2.371261     2.375574      0.015685       0.015868             0.607143              0.571429             0.892857              0.892857             0.964286              0.964286              0.964286               0.964286
     3 31     1.698560      1.694068    2.560311     2.544613      0.018379       0.018378             0.645161              0.645161             0.838710              0.838710             0.870968              0.870968              0.935484               0.935484
     4 30     1.301227      1.319663    2.307176     2.318497      0.014939       0.015165             0.600000              0.600000             0.966667              0.966667             1.000000              1.000000              1.000000               1.000000
     5 31     1.265513      1.277317    2.291701     2.298377      0.013226       0.013379             0.612903              0.612903             0.967742              1.000000             1.000000              1.000000              1.000000               1.000000
     6 28     1.434481      1.434760    2.375973     2.382013      0.015322       0.015314             0.678571              0.714286             0.857143              0.857143             0.964286              1.000000              1.000000               1.000000
     7 31     1.222013      1.218232    2.274176     2.274323      0.013445       0.013391             0.741935              0.741935             0.967742              0.967742             1.000000              1.000000              1.000000               1.000000
     8 31     1.072198      1.061392    2.205023     2.193926      0.011669       0.011599             0.806452              0.806452             1.000000              1.000000             1.000000              1.000000              1.000000               1.000000
     9 30     1.098713      1.093513    2.216176     2.207764      0.012900       0.012847             0.766667              0.700000             0.966667              1.000000             1.000000              1.000000              1.000000               1.000000
    10 31     1.045436      1.038961    2.192719     2.182940      0.012368       0.012303             0.709677              0.709677             1.000000              1.000000             1.000000              1.000000              1.000000               1.000000
    11 30     1.181456      1.199089    2.252685     2.257193      0.013043       0.013219             0.666667              0.633333             1.000000              0.966667             1.000000              1.000000              1.000000               1.000000
    12 31     1.275445      1.264166    2.306920     2.295197      0.014561       0.014443             0.677419              0.709677             0.903226              0.935484             0.967742              0.967742              0.967742               0.967742

## Plots
coverage_comparison.png
crps_timeseries.png
pit_histogram.png
reliability_thresholds.png
sharpness_comparison.png

## Files
predictions_2025.csv
calibration_residuals.csv
scores_breakdown_by_bin.csv
scores_breakdown_by_month.csv